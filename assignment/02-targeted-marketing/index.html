<!DOCTYPE html>
<html lang="en-gb"
      xmlns:og="http://ogp.me/ns#"
      xmlns:fb="https://www.facebook.com/2008/fbml">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="author" content="Roger Beecham">
    <meta name="description" content="Introduces techniques for simulating and predicting social behaviour">

    <meta name="twitter:card" value="summary_large_image">
    <meta name="twitter:site" content="@rjbeecham">
    <meta name="twitter:title" content="Practical 2 : targeted marketing | GEOG5927M: Predictive Analytics">
    <meta name="twitter:creator" content="@rjbeecham">
    <meta name="twitter:image" content="http://www.roger-beecham.com/predictive-analytics/images/geog5927m.png">
    <meta name="twitter:description" content="Introduces techniques for simulating and predicting social behaviour" />

    <meta property="og:site_name" content="GEOG5927M: Predictive Analytics"/>
    <meta property="og:title" content="Practical 2 : targeted marketing | GEOG5927M: Predictive Analytics">
    <meta property="og:type" content="article" />
    <meta property="article:author" content="" />
    <meta property="og:url" content="http://www.roger-beecham.com/predictive-analytics/" />
    <meta property="og:image" content="http://www.roger-beecham.com/predictive-analytics/images/geog5927m.png">
    <meta property="og:description" content="Introduces techniques for simulating and predicting social behaviour" />

    <meta name="generator" content="Hugo 0.54.0" />    

    <title>Practical 2 : targeted marketing | GEOG5927M: Predictive Analytics</title>
    <link rel="canonical" href="http://www.roger-beecham.com/predictive-analytics/assignment/02-targeted-marketing/">
    <link href="../../theme/css/tufte.css" rel="stylesheet">
    <link href="../../theme/css/latex.css" rel="stylesheet">
    <link href="../../theme/css/custom.css" rel="stylesheet">

    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->

    <style type="text/css">
        .wrap a, .wrap a:visited {
            color: #a50f15;
        }

        .wrap a:hover {
            color: #ef3b2c;
        }

        .wrap p > a {
            color: #a50f15;
        }

        article .sidenote-number:after, article .sidenote:before {
            color: #a50f15;
        }

        article .sidenote:before {
            color: #a50f15;
        }

        @media (max-width: 760px) {
            label.margin-toggle:not(.sidenote-number) {
                color: #a50f15;
            }
        }

        .contrast a, .contrast a:visited {
            color: #a50f15; 
        }

        header > nav a {
            color: #a50f15;
        }

        .credits a {
            color: #a50f15;
        }

        .wrap .tag {
            background: #a50f15;
        }
    </style>

    <link rel="shortcut icon" href="http://www.roger-beecham.com/predictive-analytics/favicon.ico" />
    <link rel="apple-touch-icon-precomposed" sizes="57x57" href="http://www.roger-beecham.com/predictive-analytics/images/apple-touch-icon-57x57.png" />
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="http://www.roger-beecham.com/predictive-analytics/images/apple-touch-icon-114x114.png" />
    <link rel="apple-touch-icon-precomposed" sizes="72x72" href="http://www.roger-beecham.com/predictive-analytics/images/apple-touch-icon-72x72.png" />
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="http://www.roger-beecham.com/predictive-analytics/images/apple-touch-icon-144x144.png" />
    <link rel="apple-touch-icon-precomposed" sizes="120x120" href="http://www.roger-beecham.com/predictive-analytics/images/apple-touch-icon-120x120.png" />
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="http://www.roger-beecham.com/predictive-analytics/images/apple-touch-icon-152x152.png" />
    <link rel="icon" type="image/png" href="http://www.roger-beecham.com/predictive-analytics/images/favicon-32x32.png" sizes="32x32" />
    <link rel="icon" type="image/png" href="http://www.roger-beecham.com/predictive-analytics/images/favicon-16x16.png" sizes="16x16" />
    <meta name="application-name" content="GEOG5927M: Predictive Analytics"/>
    <meta name="msapplication-TileColor" content="#FFFFFF" />
    <meta name="msapplication-TileImage" content="http://www.roger-beecham.com/predictive-analytics/images/mstile-144x144.png" />

    
    <link href="https://fonts.googleapis.com/css?family=Oswald:400,600|Roboto:300,400" rel="stylesheet">
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.3/css/all.css" integrity="sha384-UHRtZLI+pbxtHCWp1t77Bi1L4ZtiqrqD80Kn4Z8NTSRyMA2Fd33n5dQ8lWUE00s/" crossorigin="anonymous">


</head>

<body>
<div class="wrap">
    <header>
        <nav class="group logo-wrap">
            <a href="../../" class="logo"><img src="http://www.roger-beecham.com/predictive-analytics/images/geog5927m.png" alt="Predictive Analytics"></a>
            <h1 class="websitetitle"><a href="http://www.roger-beecham.com/predictive-analytics/">GEOG5927M: Predictive Analytics</a></h1>
        </nav>
        <nav class="bottom-group">
            
            <a href="../../syllabus/">Syllabus</a>
            
            <a href="../../schedule/">Schedule</a>
            
            <a href="../../install/">R</a>
            
        </nav>
    </header>


    <article class="group">
    <h1>Practical 2 : targeted marketing</h1>

    
    
    

    
<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    background-color: #ffffff;
    color: #a0a0a0;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #a0a0a0;  padding-left: 4px; }
div.sourceCode
  { color: #1f1c1b; background-color: #ffffff; }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span. { color: #1f1c1b; } /* Normal */
code span.al { color: #bf0303; background-color: #f7e6e6; font-weight: bold; } /* Alert */
code span.an { color: #ca60ca; } /* Annotation */
code span.at { color: #0057ae; } /* Attribute */
code span.bn { color: #b08000; } /* BaseN */
code span.bu { color: #644a9b; font-weight: bold; } /* BuiltIn */
code span.cf { color: #1f1c1b; font-weight: bold; } /* ControlFlow */
code span.ch { color: #924c9d; } /* Char */
code span.cn { color: #aa5500; } /* Constant */
code span.co { color: #898887; } /* Comment */
code span.cv { color: #0095ff; } /* CommentVar */
code span.do { color: #607880; } /* Documentation */
code span.dt { color: #0057ae; } /* DataType */
code span.dv { color: #b08000; } /* DecVal */
code span.er { color: #bf0303; text-decoration: underline; } /* Error */
code span.ex { color: #0095ff; font-weight: bold; } /* Extension */
code span.fl { color: #b08000; } /* Float */
code span.fu { color: #644a9b; } /* Function */
code span.im { color: #ff5500; } /* Import */
code span.in { color: #b08000; } /* Information */
code span.kw { color: #1f1c1b; font-weight: bold; } /* Keyword */
code span.op { color: #1f1c1b; } /* Operator */
code span.ot { color: #006e28; } /* Other */
code span.pp { color: #006e28; } /* Preprocessor */
code span.re { color: #0057ae; background-color: #e0e9f8; } /* RegionMarker */
code span.sc { color: #3daee9; } /* SpecialChar */
code span.ss { color: #ff5500; } /* SpecialString */
code span.st { color: #bf0303; } /* String */
code span.va { color: #0057ae; } /* Variable */
code span.vs { color: #bf0303; } /* VerbatimString */
code span.wa { color: #bf0303; } /* Warning */
</style>


<!-- Override tufte.CSS text size in tables. -->
<style>
  .wrap th, .wrap td {
  font-size: 0.9rem;
 }
</style>
<p><em>The aim of this practical is to perform a data analysis on the synthetic dataset you generated last week in order to identify a group (or groups) of customers at whom a marketing strategy could be targeted. You will generate summary statistics and data graphics that will characterise what makes your customer groups distinctive from the Leeds population as a whole.</em></p>
<h2 id="task-0-re-visit-the-datasets">Task 0: Re-visit the datasets</h2>
<p>Last week you worked in R and RStudio to create a synthetic population for the c.320,600 households in Leeds using functions contained in the <a href="https://philmikejones.github.io/rakeR/index.html"><code>rakeR</code></a> package. You started with an individual-level survey dataset describing holiday-making behaviours and allocated individuals from this dataset to Output Areas (OAs) in Leeds based on 2011 Census data.</p>
<p>Re-open your <code>.Rproj</code> from last week’s practical. The <code>Environment</code> window in RStudio should list the datasets that you worked upon. Re-familiarise yourslef with these by entering <code>glimpse(&lt;tibble-name&gt;)</code> into the R console.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" title="1"><span class="op">&gt;</span><span class="st"> </span><span class="kw">glimpse</span>(simulated_oac_age_sex)</a>
<a class="sourceLine" id="cb1-2" title="2">Observations<span class="op">:</span><span class="st"> </span><span class="dv">320</span>,<span class="dv">596</span></a>
<a class="sourceLine" id="cb1-3" title="3">Variables<span class="op">:</span><span class="st"> </span><span class="dv">11</span></a>
<a class="sourceLine" id="cb1-4" title="4"><span class="op">$</span><span class="st"> </span>person_id            <span class="op">&lt;</span>int<span class="op">&gt;</span><span class="st"> </span><span class="dv">56</span>, <span class="dv">63</span>, <span class="dv">261</span>, <span class="dv">306</span>, <span class="dv">326</span>, <span class="dv">348</span>, <span class="dv">402</span>, <span class="dv">495</span>, <span class="dv">654</span>, <span class="dv">709</span>, <span class="dv">712</span>, <span class="dv">831</span>,…</a>
<a class="sourceLine" id="cb1-5" title="5"><span class="op">$</span><span class="st"> </span>zone                 <span class="op">&lt;</span>chr<span class="op">&gt;</span><span class="st"> &quot;E00056750&quot;</span>, <span class="st">&quot;E00056750&quot;</span>, <span class="st">&quot;E00056750&quot;</span>, <span class="st">&quot;E00056750&quot;</span>, <span class="st">&quot;E000…</span></a>
<a class="sourceLine" id="cb1-6" title="6"><span class="st">$ oac_grp              &lt;fct&gt; 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, …</span></a>
<a class="sourceLine" id="cb1-7" title="7"><span class="st">$ sex                  &lt;fct&gt; m, f, m, m, m, m, m, f, m, m, m, m, m, f, f, f, f, f, m, …</span></a>
<a class="sourceLine" id="cb1-8" title="8"><span class="st">$ age_band             &lt;fct&gt; a65over, a25to34, a25to34, a65over, a50to64, a25to34, a35…</span></a>
<a class="sourceLine" id="cb1-9" title="9"><span class="st">$ number_children      &lt;int&gt; 0, 2, 0, 0, 0, 2, 2, 0, 0, 2, 0, 0, 1, 0, 0, 2, 0, 0, 0, …</span></a>
<a class="sourceLine" id="cb1-10" title="10"><span class="st">$ household_income     &lt;chr&gt; &quot;</span>Not Answered<span class="st">&quot;, &quot;</span><span class="dv">26</span><span class="op">-</span>30K<span class="st">&quot;, &quot;</span><span class="dv">26</span><span class="op">-</span>30K<span class="st">&quot;, &quot;</span>Not Answered<span class="st">&quot;, &quot;</span>Not …</a>
<a class="sourceLine" id="cb1-11" title="11"><span class="op">$</span><span class="st"> </span>overseas_airport     <span class="op">&lt;</span>chr<span class="op">&gt;</span><span class="st"> &quot;PMI&quot;</span>, <span class="st">&quot;FAO&quot;</span>, <span class="st">&quot;CUN&quot;</span>, <span class="st">&quot;TFS&quot;</span>, <span class="st">&quot;PXO&quot;</span>, <span class="st">&quot;IBZ&quot;</span>, <span class="st">&quot;PMI&quot;</span>, <span class="st">&quot;DLM&quot;</span>, <span class="st">&quot;…</span></a>
<a class="sourceLine" id="cb1-12" title="12"><span class="st">$ uk_airport           &lt;chr&gt; &quot;</span>MAN<span class="st">&quot;, &quot;</span>LBA<span class="st">&quot;, &quot;</span>LBA<span class="st">&quot;, &quot;</span>MAN<span class="st">&quot;, &quot;</span>LBA<span class="st">&quot;, &quot;</span>LBA<span class="st">&quot;, &quot;</span>MAN<span class="st">&quot;, &quot;</span>LBA<span class="st">&quot;, &quot;</span>…</a>
<a class="sourceLine" id="cb1-13" title="13"><span class="op">$</span><span class="st"> </span>satisfaction_overall <span class="op">&lt;</span>chr<span class="op">&gt;</span><span class="st"> &quot;poor&quot;</span>, <span class="st">&quot;fair&quot;</span>, <span class="st">&quot;poor&quot;</span>, <span class="st">&quot;excellent&quot;</span>, <span class="st">&quot;good&quot;</span>, <span class="st">&quot;poor&quot;</span>, <span class="st">&quot;poo…</span></a>
<a class="sourceLine" id="cb1-14" title="14"><span class="st">$ age_sex              &lt;fct&gt; m65over, f25to34, m25to34, m65over, m50to64, m25to34, m35…</span></a></code></pre></div>
<p>Create a new RMarkdown file by selecting <code>File &gt; New &gt; New R Markdown...</code>, click <code>OK</code> with the default options, then delete all the placeholder code/text in the new file.</p>
<p>Paste into your RMarkdown file the notes from <a href="../../files/02-code-targeted-marketing.Rmd">this document</a>, which contains an outline/skeleton of what you’ll need to complete the practical. Save the file with an appropriate name (<code>practical2</code>).</p>
<h2 id="task-1-study-available-variables">Task 1: study available variables</h2>
<p>This practical session introduces a data analysis to inform a marketing strategy<span><label for="sn-1" class="margin-toggle sidenote-number"></label><input type="checkbox" id="sn-1" class="margin-toggle"/><span class="sidenote">Targeted marketing involves identifying a set of customers that are distinctive in some way and characterising them such that marketing activity could be tailored to them. We are not at all interested in the substantive elements of a marketing strategy in this practical (and module); but rather in the elements of data analysis that could be used to inform and focus strategy development.<br />
<br />
</span></span>. In order to do this, we want to characterise the potential customer population as fully as possible given the data available to us.</p>
<p><strong>Geography</strong> is important – where customers of a particular category live and also the <em>types</em> of area in which they live. The simulated dataset allocates individuals to <a href="https://www.ons.gov.uk/census/2001censusandearlier/dataandproducts/outputgeography/outputareas">Output Areas (OAs)</a>, so we have an indicator of this. These OAs can also be linked to <a href="http://www.opengeodemographics.com">geodemographics</a>.</p>
<p><strong>Demographics</strong> clearly play a role – how old and how affluent potential customers are will influence their holiday-making behaviour. In addition to geodemographics, there are known demographic characteristics in the simulated data: <code>sex</code>, <code>age_band</code>, <code>household_income</code>, <code>number_children</code>.</p>
<p><strong>Psychographics</strong> is another concept used in targeted marketing, which refers to customer attitudes, aspirations and choices. Psychographics are more difficult to measure because they require some way of ascertaining what people think. In your dataset there are a limited range of these: the destination choice (<code>overseas_airport</code>) suggests something about preference and also how satisfied customers were with their most recent holiday (<code>satisfaction_overall</code>).</p>
<h3 id="task-1.1-attach-oac-and-airport-names">Task 1.1: Attach OAC and Airport names</h3>
<p>Inspecting the variables in the simulated dataset, you may have noticed that full names are missing for the <code>oac_grp</code> (numeric values rather than supergroup names) and <code>uk_airport</code> and <code>overseas_airport</code>. Lookup tables containing full names are provided as <code>.csv</code> files in the <code>./data/info</code> directory. We can add these to our simulated dataset, again using <code>dplyr::join</code>.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" title="1"><span class="co"># Read in lookup tables.</span></a>
<a class="sourceLine" id="cb2-2" title="2">oac_lookup &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&quot;./data/info/oac_lookup.csv&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb2-3" title="3"><span class="st">  </span><span class="co"># Cast oac_supergroup as character to join with factor variable in simuldated data.</span></a>
<a class="sourceLine" id="cb2-4" title="4"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">supergroup_code=</span><span class="kw">as.character</span>(supergroup_code))</a>
<a class="sourceLine" id="cb2-5" title="5">airport_lookup &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&quot;./data/info/airport_lookup.csv&quot;</span>)</a>
<a class="sourceLine" id="cb2-6" title="6"></a>
<a class="sourceLine" id="cb2-7" title="7"><span class="co"># Join oac names with simulated_oac_age_sex.</span></a>
<a class="sourceLine" id="cb2-8" title="8"><span class="co"># Specify variables on which to join as names not identical.</span></a>
<a class="sourceLine" id="cb2-9" title="9">simulated_oac_age_sex &lt;-<span class="st"> </span>simulated_oac_age_sex <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb2-10" title="10"><span class="st">  </span><span class="kw">left_join</span>(oac_lookup, <span class="dt">by=</span><span class="kw">c</span>(<span class="st">&quot;oac_grp&quot;</span>=<span class="st">&quot;supergroup_code&quot;</span>))</a>
<a class="sourceLine" id="cb2-11" title="11"></a>
<a class="sourceLine" id="cb2-12" title="12"><span class="co"># Join airport codes names with simulated_oac_age_sex.</span></a>
<a class="sourceLine" id="cb2-13" title="13"><span class="co"># Specify variables on which to join as names not identical.</span></a>
<a class="sourceLine" id="cb2-14" title="14">simulated_oac_age_sex &lt;-<span class="st"> </span>simulated_oac_age_sex <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb2-15" title="15"><span class="st">  </span><span class="co"># Do separately for overseas.</span></a>
<a class="sourceLine" id="cb2-16" title="16"><span class="st">  </span><span class="kw">left_join</span>(airport_lookup, <span class="dt">by=</span><span class="kw">c</span>(<span class="st">&quot;overseas_airport&quot;</span>=<span class="st">&quot;airport_code&quot;</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb2-17" title="17"><span class="st">  </span><span class="co"># Add dest_ prefix so can distinguish destination from origin.</span></a>
<a class="sourceLine" id="cb2-18" title="18"><span class="st">  </span><span class="kw">rename_at</span>(<span class="kw">vars</span>(airport_name<span class="op">:</span>airport_country), <span class="kw">funs</span>(<span class="kw">paste0</span>(<span class="st">&quot;dest_&quot;</span>,.))) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb2-19" title="19"><span class="st">  </span><span class="co"># And UK airports.</span></a>
<a class="sourceLine" id="cb2-20" title="20"><span class="st">  </span><span class="kw">left_join</span>(airport_lookup, <span class="dt">by=</span><span class="kw">c</span>(<span class="st">&quot;uk_airport&quot;</span>=<span class="st">&quot;airport_code&quot;</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb2-21" title="21"><span class="st">  </span><span class="co"># Add orig_ prefix so can distinguish destination from origin.</span></a>
<a class="sourceLine" id="cb2-22" title="22"><span class="st">  </span><span class="kw">rename_at</span>(<span class="kw">vars</span>(airport_name<span class="op">:</span>airport_country), <span class="kw">funs</span>(<span class="kw">paste0</span>(<span class="st">&quot;orig_&quot;</span>,.)))</a></code></pre></div>
<h3 id="task-1.2-generate-frequency-plots">Task 1.2: Generate frequency plots</h3>
<p>An initial means of exploring how the simulated population distributes on these categorical variables is to plot frequencies across those categories. The code snippet below, also in the <code>.Rmd</code>, displays frequencies of the simulated population amongst each <code>age_band</code>, using <a href="https://ggplot2.tidyverse.org"><code>ggplot2</code></a>.<span><label for="sn-2" class="margin-toggle">&#8853;</label><input type="checkbox" id="sn-2" class="margin-toggle"/><span class="marginnote"><img src="../../images/assignment/practical2_oac.png" alt="Plot OAC" /><br />
<br />
</span></span></p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" title="1"><span class="kw">ggplot</span>(<span class="dt">data=</span>simulated_oac_age_sex, <span class="dt">mapping=</span><span class="kw">aes</span>(<span class="dt">x=</span>age_band))<span class="op">+</span></a>
<a class="sourceLine" id="cb3-2" title="2"><span class="st">  </span><span class="kw">geom_bar</span>()</a></code></pre></div>
<p><code>ggplot2</code> specifications have a consistent form that identifies how data are <em>mapped</em> to visuals:</p>
<ol style="list-style-type: decimal">
<li>Identify dataset : <code>data=</code></li>
<li>Specify the <em>mapping</em> : <code>aes(x=..., y=..., fill=..., ...)</code></li>
<li>Select a <em>geometry</em> (or marks) layer : <code>geom_...</code></li>
</ol>
<p>You should relate the form of <code>ggplot2</code> specifications – the <code>ggplot2</code> <em>grammar</em> – to the <em>encodings</em> of data and visual channels discussed in <a href="http://www.roger-beecham.com/GEOG5042-data-visualization/index.html">GEOG5032’s</a> session on Data Visualization in Tableau.</p>
<p>Given this, now write <code>ggplot</code> specifications <strong>of your own</strong> for the other variables in the simulated dataset<span><label for="sn-3" class="margin-toggle sidenote-number"></label><input type="checkbox" id="sn-3" class="margin-toggle"/><span class="sidenote">Hint: You will need to change the parameterisation to <code>aes()</code>.<br />
<br />
</span></span>.</p>
<h3 id="task-1.3-generate-frequency-plots-on-variables-with-many-categories">Task 1.3: Generate frequency plots on variables with many categories</h3>
<p><span><label for="sn-4" class="margin-toggle">&#8853;</label><input type="checkbox" id="sn-4" class="margin-toggle"/><span class="marginnote"><img src="../../images/assignment/practical2_dests.png" alt="Plot destinations" /><br />
<br />
</span></span>Bar charts are effective at conveying frequencies across categories where the number of levels is reasonably small. You may wish to consider alternatives, such as <a href="https://en.wikipedia.org/wiki/Dot_plot_(statistics)">Cleveland dot plots</a>, for summarising frequencies in data with many levels (destinations in this case).</p>
<p>The code snippet below is a ggplot2 specification for generating a dotplot of frequencies by airport destination. This plot is ordered according to the frequency with which countries are visited, and within countries, the frequency with which airports are visited. In order to effect this ordering, we cast the country variable (<code>dest_airport_country</code>) and airport variable (<code>overseas_airport</code>) as <a href="https://r4ds.had.co.nz/factors.html">factors</a> and order the factor levels by frequency. There are also some updates to the encodings: since we wish to display frequencies top-to-bottom, airport names (<code>overseas_aiport</code>) are mapped to the <code>y</code> aesthetic (<code>aes()</code>) and frequencies to the <code>x</code> aesthetic, we also use <a href="https://r4ds.had.co.nz/data-visualisation.html#facets"><code>facet()</code></a> in order to group the plot by destination country.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" title="1"><span class="co"># Generate tibble of countries ordered by frequency (for ordered factors).</span></a>
<a class="sourceLine" id="cb4-2" title="2">order_country &lt;-<span class="st"> </span>simulated_oac_age_sex <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb4-3" title="3"><span class="st">  </span><span class="kw">group_by</span>(dest_airport_country) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb4-4" title="4"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">count=</span><span class="kw">n</span>()) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb4-5" title="5"><span class="st">  </span><span class="kw">arrange</span>(<span class="op">-</span>count)</a>
<a class="sourceLine" id="cb4-6" title="6"></a>
<a class="sourceLine" id="cb4-7" title="7"><span class="co"># Cleveland dot plot of destinations, grouped by country.</span></a>
<a class="sourceLine" id="cb4-8" title="8">simulated_oac_age_sex <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb4-9" title="9"><span class="st">  </span><span class="co"># Order dest countries, casting as a factor and ordering levels on frequency.</span></a>
<a class="sourceLine" id="cb4-10" title="10"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">dest_airport_country=</span><span class="kw">factor</span>(dest_airport_country,<span class="dt">levels=</span>order_country<span class="op">$</span>dest_airport_country)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb4-11" title="11"><span class="st">  </span><span class="co"># Calculate num holidays to each dest airport.</span></a>
<a class="sourceLine" id="cb4-12" title="12"><span class="st">  </span><span class="kw">group_by</span>(overseas_airport) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb4-13" title="13"><span class="st">    </span><span class="kw">summarise</span>(<span class="dt">count_airport=</span><span class="kw">n</span>(), <span class="dt">dest_airport_country=</span><span class="kw">first</span>(dest_airport_country)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb4-14" title="14"><span class="st">    </span><span class="co"># Order by these frequencies.</span></a>
<a class="sourceLine" id="cb4-15" title="15"><span class="st">    </span><span class="kw">arrange</span>(count_airport) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb4-16" title="16"><span class="st">    </span><span class="co"># Cast as factor and order levels.</span></a>
<a class="sourceLine" id="cb4-17" title="17"><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">overseas_airport=</span><span class="kw">factor</span>(overseas_airport,<span class="dt">levels=</span>.<span class="op">$</span>overseas_airport)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb4-18" title="18"><span class="st">  </span><span class="co"># List airports vertically and frequencies horizontally.</span></a>
<a class="sourceLine" id="cb4-19" title="19"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x=</span>count_airport,<span class="dt">y=</span>overseas_airport))<span class="op">+</span></a>
<a class="sourceLine" id="cb4-20" title="20"><span class="st">    </span><span class="kw">geom_segment</span>(<span class="kw">aes</span>(<span class="dt">x=</span><span class="dv">0</span>, <span class="dt">y=</span>overseas_airport, <span class="dt">xend=</span>count_airport, <span class="dt">yend=</span>overseas_airport), <span class="dt">colour=</span><span class="st">&quot;#636363&quot;</span>)<span class="op">+</span></a>
<a class="sourceLine" id="cb4-21" title="21"><span class="st">    </span><span class="kw">geom_point</span>(<span class="dt">colour=</span><span class="st">&quot;#636363&quot;</span>, <span class="dt">fill=</span><span class="st">&quot;#cccccc&quot;</span>, <span class="dt">shape=</span><span class="dv">21</span>)<span class="op">+</span></a>
<a class="sourceLine" id="cb4-22" title="22"><span class="st">    </span><span class="co"># Facet the plot on country to display group freq by destination country.</span></a>
<a class="sourceLine" id="cb4-23" title="23"><span class="st">    </span><span class="kw">facet_grid</span>(dest_airport_country<span class="op">~</span>., <span class="dt">scales=</span><span class="st">&quot;free_y&quot;</span>, <span class="dt">space=</span><span class="st">&quot;free_y&quot;</span>)<span class="op">+</span></a>
<a class="sourceLine" id="cb4-24" title="24"><span class="st">    </span><span class="kw">theme</span>(  <span class="dt">strip.text.y =</span> <span class="kw">element_text</span>(<span class="dt">angle=</span><span class="dv">0</span>))</a></code></pre></div>
<h2 id="task-2-explore-research-questions">Task 2: Explore research questions</h2>
<p>You now have some knowledge of the data available to you and how the synthetic Leeds population distributes on these key datasets. Next, you should kick-on with your data analysis by identifying research themes and performing exploratory analyses on those themes.</p>
<p>In the example provided here we focus on a single destination, Palma Mallorca (PMI), part of the Balearic Islands, and a destination associated with beach-style holidays<span><label for="sn-5" class="margin-toggle sidenote-number"></label><input type="checkbox" id="sn-5" class="margin-toggle"/><span class="sidenote">When you begin data analysis on your assignment, you should think carefully about the analysis focus. For instance, you may choose to group destinations according to some category – <em>city break</em>, <em>beach holiday</em>, etc. – and characterise the customer populations holidaying to that destination category. You may wish to start with a customer type – for example <em>younger adults without children</em> – and identify destination categories that are accessed by that customer type.<br />
<br />
</span></span>. For a marketing strategy focused on Mallorca, it is clearly useful to profile the known customer population holidaying there (implied by the synthetic population). We will do this in two ways:</p>
<ol style="list-style-type: decimal">
<li>Observing frequencies of known PMI holiday-makers by customer group.</li>
<li>Comparing these observed frequencies against the frequencies that would be expected given the Leeds holiday-making population as a whole.</li>
</ol>
<h3 id="task-2.1-calculate-totals-and-proportions">Task 2.1: Calculate totals and proportions</h3>
<p>You will notice from the Cleveland dotplot that Palma Mallorca is the destination most frequently visited by the synthetic Leeds population. Using some <code>dplyr</code> functions – <code>filter()</code>, <code>summarise()</code> – I calculated a total of <em>25,030</em> households holidaying to Palma Mallorca, <em>c.8%</em> of all Leeds households. You may wish to check that a similar figure is recorded<span><label for="sn-6" class="margin-toggle sidenote-number"></label><input type="checkbox" id="sn-6" class="margin-toggle"/><span class="sidenote">Don’t worry if your calculations do not exactly match mine: there is a stochastic element to the procedure we used for running the spatial microsimulation and your synthetic dataset may have been specified with a different set of constraint variables to mine<br />
<br />
</span></span> for your synthetic dataset by writing some code to calculate the total number of households holidaying to Palma Mallorca.</p>
<p>Finding that Palma Mallorca, and destinations in Spain, are those most frequently visited by the synthetic population is fine. Far more interesting and useful is information on the characteristics of the <em>c.8%</em> of households that have visited Palma Mallorca and particularly whether those characteristics are discriminating – e.g. the extent to which they are different from the Leeds population as a whole. The code block below makes use of <code>dplyr</code> functions to calculate:</p>
<ol style="list-style-type: decimal">
<li>The number of Leeds households holidaying to Palma Mallorca by OAC group expressed as a proportion of all holiday-makers to Palma Mallorca</li>
<li>The number of Leeds households by OAC group expressed as a proportion of all Leeds households</li>
</ol>
<p>Comparing these numbers allows us to evaluate whether particular OAC groups are <em>over-</em> or <em>under-</em> <em>represented</em> amongst those holidaying to Palma Mallorca.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" title="1">simulated_oac_age_sex <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb5-2" title="2"><span class="st">  </span><span class="co"># Dummy variable identifying destination to be profiled: PMI.</span></a>
<a class="sourceLine" id="cb5-3" title="3"><span class="st">  </span><span class="kw">mutate</span>(</a>
<a class="sourceLine" id="cb5-4" title="4">    <span class="co"># Edit the if_else() to switch focus.</span></a>
<a class="sourceLine" id="cb5-5" title="5">    <span class="dt">dest_focus=</span><span class="kw">if_else</span>(overseas_airport<span class="op">==</span><span class="st">&quot;PMI&quot;</span>,<span class="dv">1</span>,<span class="dv">0</span>),</a>
<a class="sourceLine" id="cb5-6" title="6">    <span class="dt">total_focus=</span><span class="kw">sum</span>(dest_focus)</a>
<a class="sourceLine" id="cb5-7" title="7">  ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb5-8" title="8"><span class="st">  </span><span class="co"># Calculate proportions for each OAC group.</span></a>
<a class="sourceLine" id="cb5-9" title="9"><span class="st">  </span><span class="kw">group_by</span>(supergroup_name) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb5-10" title="10"><span class="st">  </span><span class="kw">summarise</span>(</a>
<a class="sourceLine" id="cb5-11" title="11">    <span class="dt">oac_grp_focus=</span><span class="kw">sum</span>(dest_focus)<span class="op">/</span><span class="kw">first</span>(total_focus),</a>
<a class="sourceLine" id="cb5-12" title="12">    <span class="dt">oac_grp_control=</span><span class="kw">n</span>()<span class="op">/</span><span class="kw">nrow</span>(.),</a>
<a class="sourceLine" id="cb5-13" title="13">    <span class="dt">diff_focus_control=</span>oac_grp_focus<span class="op">-</span>oac_grp_control</a>
<a class="sourceLine" id="cb5-14" title="14">  )</a>
<a class="sourceLine" id="cb5-15" title="15"></a>
<a class="sourceLine" id="cb5-16" title="16">  <span class="co"># A tibble: 8 x 4</span></a>
<a class="sourceLine" id="cb5-17" title="17">  supergroup_name             oac_grp_focus oac_grp_control diff_focus_control</a>
<a class="sourceLine" id="cb5-18" title="18">  <span class="op">&lt;</span>chr<span class="op">&gt;</span><span class="st">                               </span><span class="er">&lt;</span>dbl<span class="op">&gt;</span><span class="st">           </span><span class="er">&lt;</span>dbl<span class="op">&gt;</span><span class="st">              </span><span class="er">&lt;</span>dbl<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb5-19" title="19"><span class="dv">1</span> Constrained City Dwellers          <span class="fl">0.157</span>           <span class="fl">0.105</span>            <span class="fl">0.0513</span></a>
<a class="sourceLine" id="cb5-20" title="20"><span class="dv">2</span> Cosmopolitans                      <span class="fl">0.0344</span>          <span class="fl">0.0729</span>          <span class="fl">-0.0385</span></a>
<a class="sourceLine" id="cb5-21" title="21"><span class="dv">3</span> Ethnicity Central                  <span class="fl">0.0127</span>          <span class="fl">0.0350</span>          <span class="fl">-0.0223</span></a>
<a class="sourceLine" id="cb5-22" title="22"><span class="dv">4</span> Hard<span class="op">-</span>Pressed Living                <span class="fl">0.201</span>           <span class="fl">0.165</span>            <span class="fl">0.0355</span></a>
<a class="sourceLine" id="cb5-23" title="23"><span class="dv">5</span> Multicultural Metropolitans        <span class="fl">0.140</span>           <span class="fl">0.163</span>           <span class="fl">-0.0233</span></a>
<a class="sourceLine" id="cb5-24" title="24"><span class="dv">6</span> Rural Residents                    <span class="fl">0.0114</span>          <span class="fl">0.0144</span>          <span class="fl">-0.00304</span></a>
<a class="sourceLine" id="cb5-25" title="25"><span class="dv">7</span> Suburbanites                       <span class="fl">0.216</span>           <span class="fl">0.216</span>           <span class="fl">-0.000310</span></a>
<a class="sourceLine" id="cb5-26" title="26"><span class="dv">8</span> Urbanites                          <span class="fl">0.228</span>           <span class="fl">0.228</span>            <span class="fl">0.000638</span></a></code></pre></div>
<p>The code above was deliberately written so as to be re-usable. You may wish, for example, to focus on a destination other than Palma Mallorca and profile customers holidaying there. It is possible to do so simply by changing the value with which <code>dest_focus</code> is initialised. For example, if you wanted to focus on Cancun, Mexico (CUN):</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" title="1">simulated_oac_age_sex <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb6-2" title="2"><span class="st">  </span><span class="co"># Dummy variable identifying destination to be profiled: CUN.</span></a>
<a class="sourceLine" id="cb6-3" title="3"><span class="st">  </span><span class="kw">mutate</span>(</a>
<a class="sourceLine" id="cb6-4" title="4">    <span class="co"># Edit the if_else() to switch focus.</span></a>
<a class="sourceLine" id="cb6-5" title="5">    <span class="dt">dest_focus=</span><span class="kw">if_else</span>(overseas_airport<span class="op">==</span><span class="st">&quot;CUN&quot;</span>,<span class="dv">1</span>,<span class="dv">0</span>),</a>
<a class="sourceLine" id="cb6-6" title="6">    <span class="dt">total_focus=</span><span class="kw">sum</span>(dest_focus)</a>
<a class="sourceLine" id="cb6-7" title="7">  ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb6-8" title="8"><span class="st">  </span>...</a>
<a class="sourceLine" id="cb6-9" title="9">  ...</a>
<a class="sourceLine" id="cb6-10" title="10">  ...</a></code></pre></div>
<p>You may later choose to focus your study on a list of destinations. This can be achieved by generating a vector of destination names and supplying this to <code>dest_focus</code>.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" title="1"><span class="co"># Create a vector of destination names.</span></a>
<a class="sourceLine" id="cb7-2" title="2">focus &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;PMI&quot;</span>,<span class="st">&quot;CFU&quot;</span>,<span class="st">&quot;DLM&quot;</span>)</a>
<a class="sourceLine" id="cb7-3" title="3">simulated_oac_age_sex <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb7-4" title="4"><span class="st">  </span><span class="co"># Dummy variable identifying destinations to be profiled: list_focus.</span></a>
<a class="sourceLine" id="cb7-5" title="5"><span class="st">  </span><span class="kw">mutate</span>(</a>
<a class="sourceLine" id="cb7-6" title="6">    <span class="co"># Edit the if_else() to switch focus.</span></a>
<a class="sourceLine" id="cb7-7" title="7">    <span class="dt">dest_focus=</span><span class="kw">if_else</span>(overseas_airport <span class="op">%in%</span><span class="st"> </span>focus,<span class="dv">1</span>,<span class="dv">0</span>),</a>
<a class="sourceLine" id="cb7-8" title="8">    <span class="dt">total_focus=</span><span class="kw">sum</span>(dest_focus)</a>
<a class="sourceLine" id="cb7-9" title="9">  ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb7-10" title="10"><span class="st">  </span>...</a>
<a class="sourceLine" id="cb7-11" title="11">  ...</a>
<a class="sourceLine" id="cb7-12" title="12">  ...</a></code></pre></div>
<h3 id="task-2.2-plot-totals-and-proportions">Task 2.2: Plot totals and proportions</h3>
<p>You will want to profile selected destinations not only on the OAC variables, but by the other demographic and attitudinal variables originally available in the <code>individuals</code> dataset. This could be achieved by re-using the code blocks in the previous section and editing the <code>group_by</code> – e.g. to summarise over the reported satisfaction levels for a given destination <code>group_by(satisfaction_overall)</code>.</p>
<p>This would, however, involve much copying-and-pasting of code and here I’ve abstracted the process of calculating proportions grouped on a given variable into my own <a href="https://r4ds.had.co.nz/functions.html">function</a>. You may have yet to write R functions in <a href="http://webprod3.leeds.ac.uk/catalogue/dynmodules.asp?Y=201819&amp;F=P&amp;M=LUBS-5308M">LUBS5308</a>, and there are a few syntax things happening here that look odd (<code>!!&lt;parameter-name&gt;</code>)<span><label for="sn-7" class="margin-toggle sidenote-number"></label><input type="checkbox" id="sn-7" class="margin-toggle"/><span class="sidenote">This is to do with the fact that <code>dplyr</code> functions generally use non-standard evaluation, which creates challenges when accessing <code>dplyr</code> programmatically: <a href="https://dplyr.tidyverse.org/articles/programming.html">this post</a> provides an efficient and accessible discussion.<br />
<br />
</span></span>, so do not worry too much about the details here, but a general idea of what the function achieves is useful.</p>
<p>The code snippet below defines the function – on creating this (by running the code), you will notice it listed in the <em>Global Environment</em> window of RStudio:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" title="1"><span class="co">#&#39; Calculate proportions for a focus and control variable, with user-defined grouping.</span></a>
<a class="sourceLine" id="cb8-2" title="2"><span class="co">#&#39; @param data A df with focus and control variables (focus_var, control_var).</span></a>
<a class="sourceLine" id="cb8-3" title="3"><span class="co">#&#39; @param group_var A string describing the grouping variable passed as a symbol.</span></a>
<a class="sourceLine" id="cb8-4" title="4"><span class="co">#&#39; @return A df of focus and control proportions, with diff values.</span></a>
<a class="sourceLine" id="cb8-5" title="5">calculate_props &lt;-</a>
<a class="sourceLine" id="cb8-6" title="6"><span class="st">  </span><span class="cf">function</span>(data, group_var) {</a>
<a class="sourceLine" id="cb8-7" title="7">  data <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb8-8" title="8"><span class="st">    </span><span class="kw">group_by</span>(<span class="op">!!</span>group_var) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb8-9" title="9"><span class="st">    </span><span class="kw">summarise</span>(</a>
<a class="sourceLine" id="cb8-10" title="10">      <span class="dt">focus_prop=</span><span class="kw">sum</span>(focus_var)<span class="op">/</span><span class="kw">first</span>(focus_total),</a>
<a class="sourceLine" id="cb8-11" title="11">      <span class="dt">control_prop=</span><span class="kw">sum</span>(control_var)<span class="op">/</span><span class="kw">first</span>(control_total),</a>
<a class="sourceLine" id="cb8-12" title="12">      <span class="dt">diff_prop=</span><span class="kw">first</span>(focus_prop)<span class="op">-</span><span class="kw">first</span>(control_prop),</a>
<a class="sourceLine" id="cb8-13" title="13">      <span class="dt">variable_type=</span>rlang<span class="op">::</span><span class="kw">as_string</span>(group_var)</a>
<a class="sourceLine" id="cb8-14" title="14">    ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb8-15" title="15"><span class="st">    </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb8-16" title="16"><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">variable_name=</span><span class="op">!!</span>group_var) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb8-17" title="17"><span class="st">    </span><span class="kw">select</span>(<span class="op">-!!</span>group_var)</a>
<a class="sourceLine" id="cb8-18" title="18">}</a></code></pre></div>
<p>We then create a new dataset that will hold the summary statistics (control and focus proportions) by variable type.</p>
<ol style="list-style-type: decimal">
<li>Create a vector containing the names of grouping variables supplied to <code>calculate_props()</code>. You can change these variables by editing the fields supplied to <code>select()</code>. You can also edit the destination(s) to focus on.</li>
<li>Create a new dataset with the control and focus variables (used by <code>calculate_props()</code>) defined. Note that the control variable is de-facto set to entire population, but you could select a particular subset for comparison here in the same was as the focus variable is defined.</li>
<li>Using a <a href="https://r4ds.had.co.nz/iteration.html#the-map-functions"><code>map</code></a> function, iterate over each grouping variable name and use this to parameterise <code>calculate_props()</code>.</li>
</ol>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" title="1"><span class="co"># Create a vector of the names of grouping variables that will be summarised over.</span></a>
<a class="sourceLine" id="cb9-2" title="2">groups &lt;-<span class="st"> </span><span class="kw">names</span>(simulated_oac_age_sex <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb9-3" title="3"><span class="st">                  </span><span class="kw">select</span>(supergroup_name, age_band<span class="op">:</span>household_income, satisfaction_overall))</a>
<a class="sourceLine" id="cb9-4" title="4"><span class="co"># Identify the destination in focus.</span></a>
<a class="sourceLine" id="cb9-5" title="5">focus &lt;-<span class="st"> &quot;PMI&quot;</span></a>
<a class="sourceLine" id="cb9-6" title="6">control &lt;-<span class="st"> &quot;ALL&quot;</span></a>
<a class="sourceLine" id="cb9-7" title="7"></a>
<a class="sourceLine" id="cb9-8" title="8"><span class="co"># calculate_props() requires control and focus variables, not yet contained in</span></a>
<a class="sourceLine" id="cb9-9" title="9"><span class="co"># simulated dataset. Create a new dataset with these added.</span></a>
<a class="sourceLine" id="cb9-10" title="10">temp_simulated_data &lt;-<span class="st"> </span>simulated_oac_age_sex <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb9-11" title="11"><span class="st">  </span><span class="kw">mutate</span>(</a>
<a class="sourceLine" id="cb9-12" title="12">    <span class="dt">focus_var=</span><span class="kw">if_else</span>(overseas_airport <span class="op">%in%</span><span class="st"> </span>focus,<span class="dv">1</span>,<span class="dv">0</span>),</a>
<a class="sourceLine" id="cb9-13" title="13">    <span class="dt">control_var=</span><span class="dv">1</span>,</a>
<a class="sourceLine" id="cb9-14" title="14">    <span class="dt">focus_total=</span><span class="kw">sum</span>(focus_var),</a>
<a class="sourceLine" id="cb9-15" title="15">    <span class="dt">control_total=</span><span class="kw">sum</span>(control_var),</a>
<a class="sourceLine" id="cb9-16" title="16">    <span class="dt">number_children=</span><span class="kw">as.character</span>(number_children)</a>
<a class="sourceLine" id="cb9-17" title="17"> )</a>
<a class="sourceLine" id="cb9-18" title="18"></a>
<a class="sourceLine" id="cb9-19" title="19"><span class="co"># Iterate over each grouping variable, using map_df to bind rows of returned</span></a>
<a class="sourceLine" id="cb9-20" title="20"><span class="co"># data frames.</span></a>
<a class="sourceLine" id="cb9-21" title="21">temp_plot_data &lt;-</a>
<a class="sourceLine" id="cb9-22" title="22"><span class="st"> </span>purrr<span class="op">::</span><span class="kw">map_df</span>(groups, <span class="op">~</span><span class="kw">calculate_props</span>(temp_simulated_data, rlang<span class="op">::</span><span class="kw">sym</span>(.x)))</a>
<a class="sourceLine" id="cb9-23" title="23"><span class="kw">rm</span>(temp_simulated_data)</a></code></pre></div>
<p>Finally plot these data to explore demographic and attitudinal characteristics that are <em>over-</em> or <em>under- represented</em> amongst the destination in focus. I’ve selected Ibiza (<code>IBZ</code>) and the chart does allow us to identify a category of holiday-maker to Ibiza that is discriminating: a bimodal age profile (65+ and 05-49); households with children; <em>Suburbanites</em> OAC groups and <em>not</em> <em>Cosmopolitans</em>.</p>
<figure>
<img src="../../images/assignment/practical2_plot_props.png" alt="Plot of control and focus proportions" />
</figure>
<p>The <code>ggplot2</code> specification is below, with a little data munging prior to the <code>ggplot2</code> call:</p>
<ol style="list-style-type: decimal">
<li><a href="https://r4ds.had.co.nz/tidy-data.html#spreading-and-gathering"><code>gather()</code></a> the <code>control_prop</code>, <code>focus_prop</code>, <code>diff_drop</code> variables so that they can be passed to <code>facet()</code>. These are then identified with the key <code>stat_type</code>.</li>
<li>In <code>mutate()</code> cast <code>stat_type</code> as a factor so that the levels can be be ordered in the faceted chart and create a new variable <code>stat_sign</code>, which identifies whether <code>stat_value</code> is positive or negative (we do this to differentiate bar colours left and right of the vertical line).</li>
</ol>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" title="1"><span class="co"># Define two colours used to colour pos and neg bars differently</span></a>
<a class="sourceLine" id="cb10-2" title="2">fill_colours &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;#ffffff&quot;</span>, <span class="st">&quot;#cccccc&quot;</span>)</a>
<a class="sourceLine" id="cb10-3" title="3">temp_plot_data <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb10-4" title="4"><span class="st">  </span><span class="kw">gather</span>(<span class="dt">key=</span>stat_type, <span class="dt">value=</span>stat_value, <span class="op">-</span><span class="kw">c</span>(variable_type, variable_name)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb10-5" title="5"><span class="st">  </span><span class="kw">mutate</span>(</a>
<a class="sourceLine" id="cb10-6" title="6">    <span class="dt">stat_type=</span><span class="kw">factor</span>(stat_type, <span class="dt">levels=</span><span class="kw">c</span>(<span class="st">&quot;focus_prop&quot;</span>,<span class="st">&quot;control_prop&quot;</span>,<span class="st">&quot;diff_prop&quot;</span>)),</a>
<a class="sourceLine" id="cb10-7" title="7">    <span class="dt">stat_sign=</span>stat_value<span class="op">&gt;</span><span class="dv">0</span></a>
<a class="sourceLine" id="cb10-8" title="8">  ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb10-9" title="9"><span class="st">  </span><span class="kw">filter</span>(<span class="op">!</span><span class="kw">is.na</span>(variable_name)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb10-10" title="10"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x=</span>variable_name, <span class="dt">y=</span>stat_value))<span class="op">+</span></a>
<a class="sourceLine" id="cb10-11" title="11"><span class="st">  </span><span class="co"># stat_sign is a boolean identifying whether stat_value is pos or neg.</span></a>
<a class="sourceLine" id="cb10-12" title="12"><span class="st">  </span><span class="kw">geom_col</span>(<span class="kw">aes</span>(<span class="dt">fill=</span>stat_sign), <span class="dt">colour=</span><span class="st">&quot;#636363&quot;</span>, <span class="dt">size=</span><span class="fl">0.3</span>)<span class="op">+</span></a>
<a class="sourceLine" id="cb10-13" title="13"><span class="st">  </span><span class="kw">scale_fill_manual</span>(<span class="dt">values=</span>fill_colours, <span class="dt">guide=</span><span class="ot">FALSE</span>)<span class="op">+</span></a>
<a class="sourceLine" id="cb10-14" title="14"><span class="st">  </span><span class="kw">facet_grid</span>(variable_type<span class="op">~</span>stat_type, <span class="dt">scales=</span><span class="st">&quot;free&quot;</span>, <span class="dt">space=</span><span class="st">&quot;free_y&quot;</span>)<span class="op">+</span></a>
<a class="sourceLine" id="cb10-15" title="15"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">caption=</span><span class="kw">paste0</span>(<span class="st">&quot;focus var : &quot;</span>,focus,<span class="st">&quot; | control var : &quot;</span>,control))<span class="op">+</span></a>
<a class="sourceLine" id="cb10-16" title="16"><span class="st">  </span><span class="kw">coord_flip</span>()<span class="op">+</span></a>
<a class="sourceLine" id="cb10-17" title="17"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">axis.title=</span><span class="kw">element_blank</span>(),</a>
<a class="sourceLine" id="cb10-18" title="18">        <span class="dt">strip.text.y =</span> <span class="kw">element_text</span>(<span class="dt">angle=</span><span class="dv">0</span>))</a></code></pre></div>
<h2 id="task-3-plan-your-ass1-data-analysis">Task 3: Plan your Ass#1 data analysis</h2>
<p>This practical provides re-usable code and examples that you could use to perform your Assignment 1 data analysis.</p>
<p>The precise nature and focus of your data analysis is <strong>up to you</strong> and you should certainly not feel restricted by the techniques made available here. You may wish to explore some machine learning techniques introduced to you as part of your <a href="http://webprod3.leeds.ac.uk/catalogue/dynmodules.asp?Y=201819&amp;F=P&amp;M=LUBS-5308M">LUBS5308</a> module: you could for example use <a href="https://medium.com/analytics-vidhya/a-guide-to-machine-learning-in-r-for-beginners-decision-trees-c24dfd490abb">decision trees</a> to identify sub-groups of customers associated with a selected destination or set of destinations, <a href="https://www.r-bloggers.com/chaid-and-r-when-you-need-explanation-may-15-2018/">CHAID</a> could be a particularly useful technique here; or <a href="https://www.statmethods.net/advstats/cluster.html">clustering algorithms</a> to group destination types according to the demographic and attitudinal profile of households holidaying to those locations.</p>
<p>You are <strong>not required</strong> to use these additional machine learning techniques and only use them if you fully understand them. Your assignment will be marked on the quality and clarity of your data analysis and your ability to make and convey sound analytic thinking.</p>
<p>Some general guidelines for your data analysis:</p>
<ul>
<li>Decide on a <strong>focus</strong> for your study. You may start with a set of destinations and characterise customers and potential customers to those destinations. Or you could start with set(s) of customers and identify candidate destinations for that/those subset(s) (e.g. where do over 65s go on holiday and does this vary by household income?).</li>
<li>Think carefully how you could aggregate the data: do a range of destinations represent a certain <em>type</em> of holiday?</li>
<li>Also consider additional variables not discussed in detail during this session. For example, the <code>satisfaction_overall</code> and <code>uk_airport</code> variables. Given that this was originally a survey of holiday-makers from Leeds, what might structure in the <code>uk_airport</code> variable (the airport from which customers leave the country) imply about the behavioural characteristics of a particular sub-group?</li>
</ul>
<h2 id="end-of-practical">End of practical</h2>
<p>Well done for completing this week’s practical.</p>
<p>Before you leave the practical make sure you save your work:</p>
<ul>
<li>Close your RStudio session by clicking on the red cross in the top left of the window.</li>
<li>You will be asked to save the changes to the <code>.Rmd</code> in which you enter code and discussion and a <em>Workspace image</em> with the extension <code>.RData</code>. The <code>.RData</code> file stores all data objects (<code>tibbles</code>, <code>Values</code> and <code>Functions</code>) that you have created. Be sure to save both of these.</li>
</ul>


    </article>

    <footer>
        <hr class="slender">

        <div class="course-info">
        <span class="course-name">
            GEOG5927M: Predictive Analytics (Autumn/Winter 2019)
        </span><br>
        <span>
            <a href="https://www.leeds.ac.uk">University of Leeds</a> |
            <a href="https://environment.leeds.ac.uk/geography">School of Geography</a>
        </span>
        </div>

        <ul class="footer-links">
            <li>
            <a href="http://www.roger-beecham.com"><i class="fas fa-user"></i> Dr. Roger Beecham</a>
            </li>

            <li>
            <a href="mailto:r.j.beecham@leeds.ac.uk"><i class="fas fa-envelope"></i> r.j.beecham@leeds.ac.uk</a>
            </li>

            <li>
            <i class="far fa-calendar-alt"></i> Mon (lec) &amp; Weds (lab)
            </li>

            <li>
            <i class="far fa-clock"></i> 2:00pm-4:00pm (lec)
            </li>

            <li>
            <i class="fas fa-university"></i> Roger Stevens LT25 (12.25)
            </li>

            <li>
            <a href="https://twitter.com/rjbeecham"><i class="fab fa-twitter"></i></a>
            </li>

            <li>
            <a href="https://github.com/rogerbeecham"><i class="fab fa-github"></i></a>
            </li>
        </ul>

        <div class="credits">
        <span class="credit">All content licensed under a <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/">Creative Commons Attribution-NonCommercial-NoDerivatives 4.0 International License</a>.</span><br>

        

        <span class="credit">This site adapted from the <a href="https://github.com/andrewheiss/ath-tufte-hugo_18-19">ath-tufte-hugo theme</a> (thanks to <a href="https://www.andrewheiss.com">Andrew Heiss</a>). Made with <a href="https://bookdown.org/yihui/blogdown/">blogdown</a> and <a href="https://gohugo.io/">Hugo</a>.</span>
        </div>
    </footer>

    

</div>
</body>
</html>

